PROJECT_NAME = n8n-ec2-deployment

build:
	docker compose -f docker-compose.local.yml build

up:
	docker compose -f docker-compose.local.yml up -d

down:
	docker compose -f docker-compose.local.yml down

logs:
	docker compose -f docker-compose.local.yml logs -f

logs-n8n:
	docker compose -f docker-compose.local.yml logs -f n8n

logs-caddy:
	docker compose -f docker-compose.local.yml logs -f caddy

restart:
	docker compose -f docker-compose.local.yml restart

rebuild:
	docker compose -f docker-compose.local.yml down
	docker compose -f docker-compose.local.yml build --no-cache
	docker compose -f docker-compose.local.yml up -d

shell-n8n:
	docker exec -it n8n sh

shell-caddy:
	docker exec -it caddy sh

backup:
	docker run --rm \
		-v n8n_data:/data \
		-v $(PWD):/backup \
		ubuntu \
		tar czf /backup/n8n-data-backup.tar.gz /data

restore:
	docker run --rm \
		-v n8n_data:/data \
		-v $(PWD):/backup \
		ubuntu \
		tar xzf /backup/n8n-data-backup.tar.gz -C /

clean:
	docker compose -f docker-compose.local.yml down

nuke:
	docker compose -f docker-compose.local.yml down -v

# Production targets
build-prod:
	docker compose -f docker-compose.prod.yml build

up-prod:
	docker compose -f docker-compose.prod.yml up -d

down-prod:
	docker compose -f docker-compose.prod.yml down

logs-prod:
	docker compose -f docker-compose.prod.yml logs -f

restart-prod:
	docker compose -f docker-compose.prod.yml restart
