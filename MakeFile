PROJECT_NAME = n8n-ec2-deployment

# Build the n8n image (Dockerfile-based)
build:
	docker compose build

# Start in detached mode
up:
	docker compose up -d

# Stop containers
down:
	docker compose down

# View logs for all services
logs:
	docker compose logs -f

# View logs only for n8n
logs-n8n:
	docker compose logs -f n8n

# View logs only for Caddy
logs-caddy:
	docker compose logs -f caddy

# Restart all services
restart:
	docker compose restart

# Rebuild & restart (for updates to Dockerfile)
rebuild:
	docker compose down
	docker compose build --no-cache
	docker compose up -d

# Shell into n8n container
shell-n8n:
	docker exec -it n8n sh

# Shell into caddy container
shell-caddy:
	docker exec -it caddy sh

# Backup n8n data volume to a tar file
backup:
	docker run --rm \
		-v n8n_data:/data \
		-v $(PWD):/backup \
		ubuntu \
		tar czf /backup/n8n-data-backup.tar.gz /data

# Restore backup to n8n_data volume
restore:
	docker run --rm \
		-v n8n_data:/data \
		-v $(PWD):/backup \
		ubuntu \
		tar xzf /backup/n8n-data-backup.tar.gz -C /

# Remove containers, network, but keep data
clean:
	docker compose down

# Remove everything including volumes
nuke:
	docker compose down -v
